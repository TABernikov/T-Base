<!doctype html>
<html lang="ru">

<head>
  <title>{{.Lable}}</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="Face\img\t-kom-ico 144.png">

  <link href="Face/html/css/bootstrap.min.css" rel="stylesheet">
  <link href="Face/html/css/style.css" rel="stylesheet">
  <link href="Face/html/css/bootstrap-icons.css" rel="stylesheet">
  <link href="Face/node_modules/handsontable/dist/handsontable.full.min.css" rel="stylesheet">

</head>
<body>
    
  <nav class="navbar navbar-expand-lg sticky-top navbar-light bg-light" aria-label="Fifth navbar example">
    <div class="container-fluid">
      
          <a class="navbar-brand" href="/works/prof">
            <img style="height: 6vh;" src="Face\img\t-kom-logo.svg" width="100" height="50" alt="" loading="lazy">
          </a>

          

          <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample05" aria-controls="navbarsExample05" aria-expanded="false" aria-label="Переключить навигацию">
            <span class="navbar-toggler-icon"></span>
          </button>
          
          <div class="navbar-collapse collapse" id="navbarsExample05">
            
             <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            
            <li class="nav-item">
              <a class="nav-link active" href="/works/prof">Главная <i style="color: rgb(80, 80, 80);" class="bi bi-house-fill"></i></a>
            </li>
            
            
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" aria-expanded="false">Таблицы</a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="/works/tmc">ТМЦ <i style="color: rgb(80, 80, 80);" class="bi bi-table"></i></a></li>
                <li><a class="dropdown-item" href="/works/orders">Заказы <i style="color: rgb(80, 80, 80);" class="bi bi-briefcase-fill"></i></a></li>
                <li><a class="dropdown-item" href="/works/storage">Склад <i style="color: rgb(80, 80, 80);" class="bi bi-house-fill"></i></a></li>
              </ul>
            </li>
            <a class="nav-link active" style="text-align: left;" href="/works/cal">Календарь задач <i class="bi bi-calendar-week"></i></a>
            

               
              
            </ul>
            
            <a class="btn btn-outline-primary " href="/works/tmcadvancesearch" style="width: auto;">Сложный поиск в ТМЦ <i class="bi bi-search"></i></a>
            &nbsp;
            
            <a class="btn btn-outline-primary " href="/works/tmc{{.ExcellLink}}&Veiw=table" style="width: auto;">Табличный вид <i class="bi bi-table"></i></a>
            &nbsp;
              
            
            
            <form class="d-flex" role="search" action="/works/tmc" method="post">
              <input class="form-control" type="in" id="in" name="in" placeholder="SN/Заказ/..." aria-label="Поиск">
              <input type="hidden" name="Search" value="Anything">
              <button class="btn btn-outline-success" type="submit">Поиск</button>
            </form>
        

          </div>

    </div>
  </nav>




  <iframe  name="o" float="left" width="100%"  scrolling="auto" frameborder="0" src="/works/device/mini?Id={{(index .Tab 0).Id}}" style="height: 42vh;"  id="o">Sorry, your browser doesn't support iframes.</iframe>
  <div class="container-fluid">
    {{.Lable}} <button class="d.inline btn btn-outline-primary btn-sm"name="copybtn" onclick="myFunction()"><i class="bi-copy" ></i></button>
    &nbsp;<a class="d.inline btn btn-outline-success btn-sm"name="copybtn" href="/works/tmcexcell{{.ExcellLink}}"><i class="bi-file-earmark-excel" ></i></a>
    &nbsp;<a class="d.inline btn btn-outline-primary btn-sm " href="/works/tmcadvancesearch" style="width: auto;"><i class="bi bi-filter-circle"></i> Фильтр/Поиск <i class="bi bi-search"></i></a>
    &nbsp;<button class="d.inline btn btn-outline-primary btn-sm" id="deselect" style="width: auto;">Снять выделение</button>
  </div>

  <div class="container-fluid" style="overflow-y:scroll; overflow-x: scroll; width: 100%;  height: 43vh;">
    <div id="TMCData"></div>
  </div>
    
<script>
function myFunction() {
const el = document.createElement('textarea');
el.value = "{{.SnString}}";
el.setAttribute('readonly', '');
el.style.position = 'absolute';
el.style.left = '-9999px';
document.body.appendChild(el);
el.select();
document.execCommand('copy');
document.body.removeChild(el);
}
</script>
<script src="Face/html/js/bootstrap.bundle.js"></script>
<script src="Face/html/js/keys.js"></script>


<script>

  var container = document.getElementById('TMCData');

  var datasource = [
 {{range .Tab}}
     {
       id: {{.Id}},
       sn: {{.Sn}},
       mac: {{.Mac}},
       dmodel: {{.DModel}},
       rev: {{.Rev}},
       tmodel: {{.TModel}},
       name: {{.Name}},
       condition: {{.Condition}},
       condDate: {{.CondDate}},
       order: {{.Order}},
       place: {{.Place}},
       shipped: {{.Shiped}},
       shippedDate: {{.ShipedDate}},
       shippedDest: {{.ShippedDest}},
       takenDate: {{.TakenDate}},
       takenDoc: {{.TakenDoc}},
       takenOrder: {{.TakenOrder}},
       comment: {{.Comment}},
       assembler: {{.Assembler}},
     
     },
     {{end}}
    
 ]

 var dataColumns = [
  {title: 'Id', type: 'text', data: 'id', renderer: 'customStylesRenderer'},                      //0
  {title: 'Sn', type: 'text', data: 'sn', renderer: 'customStylesRenderer'},                      //1
  {title: 'MAC', type: 'text', data: 'mac', renderer: 'customStylesRenderer'},                    //2
  {title: 'DModel', type: 'text', data: 'dmodel', renderer: 'customStylesRenderer'},              //3
  {title: 'Rev', type: 'text', data: 'rev', renderer: 'customStylesRenderer'},                    //4
  {title: 'TModel', type: 'text', data: 'tmodel', renderer: 'customStylesRenderer'},              //5
  {title: 'Имя', type: 'text', data: 'name', renderer: 'customStylesRenderer'},                   //6
  {title: 'Состояние', type: 'text', data: 'condition', renderer: 'customStylesRenderer'},        //7
  {title: 'Дата сборки', type: 'date', data: 'condDate', renderer: 'customStylesRenderer'},       //8
  {title: 'Заказ', type: 'text', data: 'order', renderer: 'customStylesRenderer'},                //9
  {title: 'Место', type: 'text', data: 'place', renderer: 'customStylesRenderer'},                //10
  {title: 'Отгрузка', type: 'text', data: 'shipped', renderer: 'customStylesRenderer'},           //11
  {title: 'Дата отгрузки', type: 'date', data: 'shippedDate', renderer: 'customStylesRenderer'},  //12
  {title: 'Место отгрузки', type: 'text', data: 'shippedDest', renderer: 'customStylesRenderer'}, //13
  {title: 'Дата приемки', type: 'date', data: 'takenDate', renderer: 'customStylesRenderer'},     //14
  {title: 'Документ приемки', type: 'text', data: 'takenDoc', renderer: 'customStylesRenderer'},  //15
  {title: 'Заказ приемки', type: 'text', data: 'takenOrder', renderer: 'customStylesRenderer'},   //16
  {title: 'Комментарий', type: 'text', data: 'comment', renderer: 'customStylesRenderer'},        //17
  {title: 'Сборщик', type: 'text', data: 'assembler', renderer: 'customStylesRenderer'},          //18
 ]

 var hiddenCol = [15, 16]

 function customRender(instance, td, row, column, prop, value, cellProperties) {
 if (td && td.parentNode) {
   var tr = td.parentNode
   var btncolor = ''
   td.parentNode.className = (row % 2 === 0 ? 'even' : 'odd');

   if (instance.getDataAtRow(row)[11] == 'true') {
     td.className += ' gray';
     btncolor = 'btn-secondary'
   }else if (instance.getDataAtRow(row)[7] == 'Собрано') {
     td.className += ' green';
     btncolor = 'btn-success'
   }else if (instance.getDataAtRow(row)[7] == 'Не собрано') {
     td.className += ' yellow';
     btncolor = 'btn-warning'
   } else if (instance.getDataAtRow(row)[7] == 'В работе') {
     td.className += ' blue';
     btncolor = 'btn-primary'
   } else {
     td.className += ' red';
     btncolor = 'btn-danger'
   }
 }
 switch (column) {
 case 9:
   td.innerHTML = `<div style = "text-align: center"> <a class="btn btn-sm btn-primary ${btncolor}" style="color: ${btncolor == 'btn-warning' ? '#000' : 'white'}; width: 80%; font-size: smaller;" role="button" href="/works/order/mini?Id=${value}" target="_blank">${value}</a></div>`;
   break;
 case 0: 
   td.innerHTML = `<div style = "text-align: center"> <a class="btn btn-sm btn-primary ${btncolor}" style="color: ${btncolor == 'btn-warning' ? '#000' : 'white'}; width: 90%; font-size: smaller;" role="button" href="/works/device/mini?Id=${value}" target="_blank"><i class="bi bi-reply-fill"></i>${value}</a></div>`;
   break;
 case 11:
   if (value == 'true') {
     td.innerHTML = '<i class="bi bi-truck"></i> &check;'
   } else {
     td.innerHTML = ''
   }
   break;
 case 17:
   td.innerHTML = `<textarea readonly class="form-control form-control-sm" style="height: 10px; width: 200px;">${value}</textarea>`
   break;
 default:
   td.innerHTML = value;
 }
 td.addEventListener('click', () => {
   document.o.location= '/works/device/mini?Id=' + instance.getDataAtRow(row)[0];
 });
}
</script>

<script type="text/javascript" src="Face/node_modules/handsontable/dist/handsontable.full.min.js"></script>
<script type="text/javascript" src="Face/node_modules/handsontable/dist/languages/ru-RU.min.js"></script>


<script>

  Handsontable.renderers.registerRenderer('customStylesRenderer', customRender);
  con = container
  colData = dataColumns
  source = datasource
  hidden = hiddenCol
  
  var hot = new Handsontable(con, {
  language: 'ru-RU',
  columns: colData,
  hiddenColumns: {indicators: true, columns: hidden},
  hiddenRows: true,
  manualColumnMove: true,
  manualColumnFreeze: true,
  manualColumnResize: true,
  data: source,
  filters: true,
  dropdownMenu: ['filter_by_condition', 'filter_by_value', 'filter_action_bar'],
  columnSorting: true,
  dateFormat: 'DD.MM.YYYY',
  readOnly: true,
  rowHeaders: true,
  height: '100%',
  autoWrapRow: true,
  autoWrapCol: true,
  contextMenu: {
    callback(key, selection, clickEvent) {
      console.log(key, selection, clickEvent);
    },
    items: {
      copy: 'copy',hidecol: 'hidden_columns_hide', showcol: 'hidden_columns_show', hiderow :'hidden_rows_hide', showrow: 'hidden_rows_show', freezcol: 'freeze_column', unfreezcol: 'unfreeze_column',
      scv: {
          name: 'Экспорт в CSV',
          callback(key, selection, clickEvent) {
          const exportPlugin = hot.getPlugin('exportFile');

          exportPlugin.downloadFile('csv', {
          bom: true,
          columnDelimiter: ';',
          columnHeaders: true,
          exportHiddenColumns: false,
          exportHiddenRows: false,
          fileExtension: 'csv',
          filename: 'Экспорт [DD].[MM].[YYYY]',
          mimeType: 'text/csv',
          rowDelimiter: '\r\n',
          rowHeaders: true
          });
          }
      },
    }
  },
  licenseKey: 'non-commercial-and-evaluation'
  });
</script>

</body>


</html>